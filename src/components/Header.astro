<header id="main-header" class="py-4 px-4 md:py-6 md:px-8 flex justify-between items-center bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50 border-b border-gray-200 dark:border-gray-800 transition-all duration-300">
  <!-- Logo con efecto más suave -->
  <h1 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-red-600 to-orange-600 
             dark:from-orange-500 dark:to-red-500 bg-clip-text text-transparent 
             hover:from-red-500 hover:to-orange-500 transition-all duration-300">
    <span class="tracking-tight">Carnitas</span>
    <span class="font-extrabold"> Roque</span>
  </h1>

  <!-- Botón mejorado -->
  <div id="phone-toggle-container">
    <button id="phone-toggle" 
      class="relative px-4 py-2 md:px-5 md:py-2.5 bg-gradient-to-r from-yellow-500 to-orange-500 
             text-white text-sm md:text-base font-medium rounded-lg 
             hover:from-yellow-600 hover:to-orange-600 
             transition-all duration-300 transform hover:scale-105 
             shadow-md hover:shadow-lg 
             focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-offset-2
             dark:focus:ring-offset-gray-900
             active:scale-95">
      <span class="flex items-center gap-2">
        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linecap="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
        Ingresar teléfono
      </span>
    </button>
  </div>
</header>

<!-- Modal de ingreso de teléfono -->
<div id="phone-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-xl p-6 w-80 shadow-lg">
    <h3 class="text-lg font-semibold mb-4">Ingresa tu número de teléfono</h3>
    <input type="tel" id="phone-input-modal" placeholder="55 1234 5678" class="w-full border px-3 py-2 rounded mb-4">
    <div class="flex justify-end gap-2">
      <button id="phone-cancel" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 transition">Cancelar</button>
      <button
  id="phone-submit"
  class="px-4 py-2 rounded-lg
         bg-gradient-to-r from-yellow-500 to-orange-500
         text-white font-medium
         hover:from-yellow-600 hover:to-orange-600
         transition-all duration-300
         shadow-md hover:shadow-lg
         active:scale-95"
>
  Entrar
</button>
    </div>
  </div>
</div>

<script>
  import { getSupabaseClient } from '../lib/supabaseClient';

  const supabase = getSupabaseClient();
let userPhone = '';

// Elementos
const phoneToggleContainer = document.getElementById('phone-toggle-container');
const phoneToggleBtn = document.getElementById('phone-toggle');
const phoneModal = document.getElementById('phone-modal');
const phoneInputModal = document.getElementById('phone-input-modal');
const phoneCancel = document.getElementById('phone-cancel');
const phoneSubmit = document.getElementById('phone-submit');

// === Función para actualizar botón según estado del teléfono ===
function updatePhoneToggle() {
  const savedPhone = localStorage.getItem('userPhone');
  if (savedPhone) {
    userPhone = savedPhone;
    if (phoneToggleBtn) phoneToggleBtn.textContent = 'Salir';
  } else {
    userPhone = '';
    if (phoneToggleBtn) phoneToggleBtn.textContent = 'Ingresar teléfono';
  }
}

// === Al cargar la página, revisar si hay teléfono guardado ===
window.addEventListener('DOMContentLoaded', () => {
  updatePhoneToggle();

});

// === Click en toggle ===
phoneToggleBtn?.addEventListener('click', () => {
  if (userPhone) {
    // Si ya hay teléfono -> salir
    localStorage.removeItem('userPhone');
    userPhone = '';
    updatePhoneToggle();
  } else {
    // Abrir modal para ingresar teléfono
    if(phoneModal) phoneModal.classList.remove('hidden');
  }
});

// === Cancelar modal ===
phoneCancel?.addEventListener('click', () => {
  if(phoneModal) phoneModal.classList.add('hidden');
});

// === Guardar teléfono desde modal ===
phoneSubmit?.addEventListener('click', async () => {
  const phone = (phoneInputModal as HTMLInputElement)?.value.trim();

  if (!phone) {
    alert("Ingresa un número de teléfono válido.");
    return;
  }

 try {
     const { data: cliente, error: selectError } = await supabase
        .from('clientes')
        .select('telefono')
        .eq('telefono', phone)
        .maybeSingle();

      if (selectError) {
        console.error('Error al verificar cliente:', selectError);
        return;
      }

      if (!cliente) {
        const { error: insertError } = await supabase
          .from('clientes')
          .insert({
            telefono: phone
          });

        if (insertError) {
          console.error('Error al crear cliente:', insertError);
        }
      }

    localStorage.setItem('userPhone', phone);
    userPhone = phone;

    updatePhoneToggle();
    if (phoneModal) phoneModal.classList.add('hidden');

  } catch (err) {
    console.error('Error inesperado:', err);
  }
});

</script>
